<?php
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Modus
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

$data['modus'] = CSiteManager::getMode();

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Das Objekt
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

$DBConnection = CDBConnection::getInstance();

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Modus: speichern!
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

if(MODE_SAVE == $data['modus'])
{
	$DBConnection->setAthLock((isset($_POST['ath_lock'])?(true):(false)));
	if(isset($_POST['upd_estatistik'])) {$DBConnection->updateRdTabEinsatzstatistik();}
	$DBConnection->setSaisonID($_POST['saison_id']);
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Detailansicht
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

$data['ath_lock'] = $DBConnection->getAthLock();
$data['dat_estatistik'] = $DBConnection->getRdDateMitgliederEinsaetze();

$data['saison_id'] = $DBConnection->getSaisonID();
$data['saison_array'] = array();
$query = 'SELECT saison_id FROM saisons ORDER BY beginn DESC';
if(!$result = mysqli_query(CDBConnection::getDB(), $query)) {throw new Exception(mysqlil_error(CDBConnection::getDB()));}
while($row = mysqli_fetch_row($result)) {$data['saison_array'][] = new CSaison($row[0]);}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// RETURN
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

return new CTemplateData($data);
?>