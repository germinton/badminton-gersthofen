<?php
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Modus und Ansicht
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

$data['modus'] = CSiteManager::getMode();
$data['view'] = C2C_Modus($data['modus']);

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Das Objekt
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

$Galerieeintrag = new CGalerieeintrag();

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Detailansicht
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//if(VIEW_DETAIL == $data['view'])
//{
	//$Mitglied = CSiteManager::getInstance()->getMitglied();
	$AthletIDArray = CSiteManager::getInstance()->getNavForSecRequest()->getAthletIDArray();
	
	if(isset($_GET['galerieeintrag_id'])) $Galerieeintrag->load($_GET['galerieeintrag_id']);
	else $Galerieeintrag->loadLatest();
	
	//if($Mitglied->hatAufgabe(S_DBENTWICKLER)) {
		//$AthletIDArray = array_unique(array_merge($AthletIDArray, array($Mitglied->getAthletID())));
	//}
	$data['heute'] = date('Y-m-d');
	$data['mitglied_array'] = array();
	foreach($AthletIDArray as $AthletID) {$data['mitglied_array'][] = new CMitglied((int)$AthletID);}
	$data['galerieeintrag'] = $Galerieeintrag;
//}


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Übersicht
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//if(VIEW_LIST == $data['view'])
//{
	//--------------------------------------------------------------------------------------------------------------------
	// Auswahl
	//--------------------------------------------------------------------------------------------------------------------
	$query = 'SELECT galerieeintrag_id '.
	         'FROM galerieeintraege '.
			 'ORDER BY datum DESC';


	//--------------------------------------------------------------------------------------------------------------------
	// Abfrage
	//--------------------------------------------------------------------------------------------------------------------
	$data['galerie_array'] = array();
	if(!$result = mysqli_query(CDBConnection::getDB(), $query)) {throw new Exception(mysqlil_error(CDBConnection::getDB()));}
	while($row = mysqli_fetch_row($result)) {$data['galerie_array'][] = new CGalerieeintrag($row[0]);}
//}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// RETURN
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

return new CTemplateData($data);
?>