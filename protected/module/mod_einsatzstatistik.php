<?php

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Filterung/Sortierung
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

$data['fltr1'] = ((isset($_GET['fltr1']))?((int)$_GET['fltr1']):(0));

$data['fs_string'] = '';
$data['fs_string'] .= (($s = $data['fltr1'])?('&amp;fltr1='.$s):(''));

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Übersicht
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

// Filterung
$query_having = array();

if($data['fltr1']) {$query_having[] = 'a.anrede='.$data['fltr1'];}

$data['MitgliederArray'] = array();
$query = 'SELECT a.athlet_id, anrede '.
	       'FROM _rd_mitglieder_einsaetze me INNER JOIN athleten a ON me.athlet_id=a.athlet_id GROUP BY a.athlet_id ';

foreach($query_having as $i => $clause) {$query .= (($i)?(' AND '):(' HAVING ')).$clause;}

$query .= ' ORDER BY sum(einsaetze) DESC';

if(!$result = mysql_query($query)) {throw new Exception(mysql_error(CDBConnection::getDB()));}
while($row = mysql_fetch_row($result)) {$data['MitgliederArray'][] = new CMitglied($row[0]);}


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// RETURN
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

return new CTemplateData($data);
?>